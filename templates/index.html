<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aethelgard Chronicles - Web Edition</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/ui/game_icon.png') }}">


        <!-- === PASTE THESE 3 LINES HERE === -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <!-- ================================ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>

    <!-- This screen shows before the user logs in -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <img src="{{ url_for('static', filename='images/ui/game_logo.png') }}" alt="Game Logo" class="game-logo">
            <div class="form-box">
                <input type="text" id="username-input" placeholder="Username">
                <input type="password" id="password-input" placeholder="Password">
                <div class="button-group">
                    <button id="login-button">Login</button>
                    <button id="register-button">Register</button>
                </div>
                <a href="#" id="forgot-password-link">Forgot Password?</a>

        <!-- === NEW VIDEO PLACEHOLDER === -->
        <div class="video-container">
            <!--
                To use this, go to your YouTube video, click "Share", then "Embed".
                Copy the 'src' part of the iframe code and paste it below.
                For example: src="https://www.youtube.com/embed/your_video_id_here"
            -->
<iframe width="560" height="315"
    src="https://www.youtube.com/embed/qGBos0uMfOo?autoplay=1&loop=1&playlist=qGBos0uMfOo&mute=1"
    title="Aethelgard Chronicles"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
    allowfullscreen>
</iframe>
        </div>
        <!-- ============================== -->

            </div>
        </div>
    </div>

    <!-- This is the main game interface, hidden until login is successful -->
    <div id="game-screen" class="screen">
        <!-- TOP BAR: Player Info -->
        <div id="top-bar">
            <div id="player-info">
                <img id="user-icon" src="{{ url_for('static', filename='images/ui/placeholder_char.png') }}" alt="User Icon" class="user-icon">
                <span id="player-name" class="clickable"></span>
                <button id="logout-button">Logout</button>
            </div>
            <div id="currency-info">
                <img src="{{ url_for('static', filename='images/ui/gem_icon.png') }}" alt="Gems">
                <span id="gem-count"></span>
                <img src="{{ url_for('static', filename='images/ui/placeholder_button.png') }}" alt="Platinum">
                <span id="platinum-count"></span>
                <img src="{{ url_for('static', filename='images/ui/placeholder_button.png') }}" alt="Gold">
                <span id="gold-count"></span>
                <img src="{{ url_for('static', filename='images/ui/placeholder_button.png') }}" alt="Energy">
                <span id="energy-count"></span>
                <img src="{{ url_for('static', filename='images/ui/placeholder_button.png') }}" alt="Dungeon Energy">
                <span id="dungeon-energy-count"></span>
                <button id="report-bug-button">Report Bug</button>
            </div>
        </div>

        <!-- MAIN CONTENT AREA: Views will be dynamically displayed here -->
        <div id="main-content">
            <!-- Home View -->
            <div id="home-view" class="view active">
                <div class="section-header">
                    <h2>Your Active Team</h2>
                    <button class="tutorial-btn" data-tutorial="This home screen shows your active team and important progress information.">?</button>
                </div>
                <div id="team-display" class="team-container"></div>

                    <!-- === NEW MESSAGE OF THE DAY SECTION === -->
    <div id="motd-container" class="motd-box">
        <h3>A Message from the Rift</h3>
        <p>
            Welcome, Rift-Mender! The Spire is particularly volatile today. Good luck on your ascent.
        </p>
        <ul>
            <li>Found a bug? <a href="https://github.com/your_username/your_repo/issues" target="_blank">Report it here!</a></li>
            <li>Top Summoner: <span id="top-player-name">Loading...</span> (Floor <span id="top-player-stage">?</span>)</li>
        </ul>
        <p id="dungeon-run-info">Dungeon Runs: <span id="dungeon-run-count">0</span></p>
        <p id="tower-progress-info">Tower Floor: <span id="tower-floor-count">1</span></p>
    </div>
    <!-- ===================================== -->


            </div>

            <!-- V3: NEW Online Users View -->
            <div id="online-view" class="view">
                 <div class="section-header">
                     <h2>Players Online</h2>
                     <button class="tutorial-btn" data-tutorial="See who is currently playing the game.">?</button>
                 </div>
                 <div id="online-list-container" class="online-list"></div>
                 <div id="all-users-container" class="online-list"></div>
           </div>
            <!-- Collection View -->
            <div id="collection-view" class="view">
                <div class="section-header">
                    <h2>Your Hero Collection</h2>
                    <button class="tutorial-btn" data-tutorial="Manage your heroes here. Merge duplicates to raise rarity. Higher rarity grants better base stats. Equip items for extra power and spend gold to level up.">?</button>
                </div>
                <div class="heroes-guide">
                    <h3>Elemental Synergy</h3>
                    <p>ðŸ”¥ Fire is strong against ðŸŒ¿ Grass (Fire burns Grass).<br>
                    ðŸŒ¿ Grass is strong against ðŸ’§ Water (Grass soaks up Water).<br>
                    ðŸ’§ Water is strong against ðŸ”¥ Fire (Water douses Fire).</p>
                    <h3>Combat Basics</h3>
                    <p>ATK and HP come from hero rarity and equipment. Crit Chance triggers stronger attacks that use Crit Damage.</p>
                </div>
                <div id="collection-container" class="collection-grid">
                    <!-- Heroes will be dynamically inserted here by JavaScript -->
                </div>
            </div>

            <!-- Summon View -->
            <div id="summon-view" class="view">
                <div class="summon-area">
                    <div class="section-header">
                        <h2>The Summoning Altar</h2>
                        <button class="tutorial-btn" data-tutorial="Spend gems here to summon additional heroes for your roster.">?</button>
                    </div>
                    <p>Use 150 Gems to summon a new hero!</p>
                    <button id="perform-summon-button">Summon</button>
                    <div id="summon-result" class="summon-result-box"></div>
                </div>
            </div>

            <!-- Store View -->
            <div id="store-view" class="view">
                <div class="section-header">
                    <h2>Platinum Shop</h2>
                    <button class="tutorial-btn" data-tutorial="Purchase Platinum or energy here. Transactions are verified server-side.">?</button>
                </div>
                <div id="store-packages" class="store-container"></div>
            </div>

            <div id="equipment-view" class="view">
    <div class="section-header">
        <h2>Your Armory</h2>
        <button class="tutorial-btn" data-tutorial="Manage your items here. Equipment boosts stats and can be merged for even better gear.">?</button>
    </div>
    <div id="equipment-container" class="collection-grid">
        <!-- Equipment will be dynamically inserted here -->
    </div>
</div>

<!-- NEW HTML -->
<!-- NEW & IMPROVED CAMPAIGN VIEW -->
<div id="campaign-view" class="view">

    <!-- The header remains the same, which is great for consistency -->
    <div class="view-header" id="tower-lore-header">
        <div class="section-header">
            <h2>The Spire of Chaos</h2>
            <button class="tutorial-btn" data-tutorial="Climb the Tower to track your progression and unlock new challenges. Each floor cleared makes your heroes stronger.">?</button>
        </div>
        <p>A festering wound in reality itself...</p>
    </div>

    <!-- We reuse the 'dungeon-container' class for consistent styling -->
    <div class="dungeon-container">

        <!-- Column 1: The Stage List -->
        <!-- We give it the 'dungeon-details-container' class to inherit its styling -->
        <div class="dungeon-details-container" id="stage-list-wrapper">
             <div id="stage-list" class="stage-list-container">
                <!-- Stages will be dynamically inserted here by JavaScript -->
            </div>
        </div>

        <!-- Column 2: The Tower Image -->
        <!-- We give it the 'dungeon-image-container' class to inherit its styling -->
        <div class="dungeon-image-container" id="tower-art-wrapper">
            <img src="{{ url_for('static', filename='images/ui/tower_art.png') }}" alt="The Spire">
        </div>

    </div>
</div>

<!-- NEW & IMPROVED DUNGEONS VIEW -->
<div id="dungeons-view" class="view">
    <div class="section-header">
        <h2>Expeditions</h2>
        <button class="tutorial-btn" data-tutorial="The Armory offers end-game items for those who conquer its challenges.">?</button>
    </div>
    <p class="view-description">Embark on a dangerous hunt for powerful rewards. The difficulty of the foe scales with your Tower progress.</p>

    <div class="dungeon-container">
        <!-- Column 1: Image -->
        <div class="dungeon-image-container">
            <img src="{{ url_for('static', filename='images/ui/dungeon_armory.png') }}" alt="The Armory">
        </div>

        <!-- Column 2: Details -->
        <div class="dungeon-details-container">
            <h3>The Armory</h3>
            <p class="dungeon-description">
                Venture into the molten heart of a forgotten forge, now guarded by chaotic constructs. Defeat the guardian for a high chance to loot powerful equipment.
            </p>
            <div class="dungeon-rewards">
                <strong>Possible Rewards:</strong>
                <div class="reward-icon-box">
                    <span>Common, Rare, & Legendary Equipment</span>
                </div>
            </div>
            <button id="enter-armory-btn" class="dungeon-fight-button">Enter The Armory</button>
        </div>
    </div>
</div>

            <!-- Lore View (Simple implementation) -->
            <div id="lore-view" class="view">
                 <div class="section-header">
                     <h2>The Lore of Aethelgard</h2>
                     <button class="tutorial-btn" data-tutorial="Read the latest updates and lore for the world.">?</button>
                 </div>
                 <div id="lore-text-container" class="lore-box"></div>
            </div>

            <div id="admin-view" class="view">
                <h2>Admin Panel</h2>
                <input type="text" id="admin-username" placeholder="Username">
                <select id="admin-action">
                    <option value="grant">Grant</option>
                    <option value="ban">Ban</option>
                    <option value="unban">Unban</option>
                    <option value="add_hero">Add Hero</option>
                    <option value="remove_hero">Remove Hero</option>
                </select>
                <input type="number" id="admin-gems" placeholder="Gems">
                <input type="number" id="admin-energy" placeholder="Energy">
                <input type="number" id="admin-platinum" placeholder="Platinum">
                <input type="number" id="admin-gold" placeholder="Gold">
                <input type="text" id="admin-character-name" placeholder="Hero name or ID">
                <button id="admin-submit-btn">Execute</button>
            </div>


        </div>

        <!-- BOTTOM NAVIGATION BAR -->
        <div id="nav-bar">
            <button class="nav-button" data-view="home-view">Home</button>
            <button class="nav-button" data-view="collection-view">Heroes</button>
            <button class="nav-button" data-view="equipment-view">Equipment</button>
            <button class="nav-button" data-view="summon-view">Summon</button>
            <button class="nav-button" data-view="store-view">Store</button>
            <button class="nav-button" data-view="campaign-view">The Tower</button>
            <button class="nav-button" data-view="dungeons-view">The Armory</button>
            <button class="nav-button" data-view="online-view">Online</button>
            <button class="nav-button" data-view="lore-view">Change Log</button>
            <button class="nav-button admin-only" data-view="admin-view">Admin</button>

        </div>

    </div>
    <!-- ======================================================= -->
    <!-- ==== NEW BATTLE SCREEN - ADD THIS ENTIRE DIV BLOCK ==== -->
    <!-- ======================================================= -->
    <div id="battle-screen" class="screen">
        <div id="battle-arena">
            <!-- Player's Team Display -->
            <div id="battle-player-side">
                <h2>Your Team</h2>
                <div id="battle-player-team" class="team-container">
                    <!-- Player heroes will be injected here by JS -->
                </div>
                <div class="hp-bar-outer">
                    <div id="player-hp-bar" class="hp-bar-inner"></div>
                    <span id="player-hp-text" class="hp-text"></span>
                </div>
            </div>

            <!-- Enemy Display -->
            <div id="battle-enemy-side">
                <h2>Enemy Team</h2>  <!-- ADD THIS LINE -->
                <div id="battle-enemy-display">
                    <!-- Enemy info will be injected here by JS -->
                </div>
                <div class="hp-bar-outer">
                    <div id="enemy-hp-bar" class="hp-bar-inner"></div>
                    <span id="enemy-hp-text" class="hp-text"></span>
                </div>
            </div>
        </div>

        <!-- The new, improved battle log -->
        <div id="battle-log-area">
            <div id="battle-log-entries"></div>
            <div class="battle-buttons">
                <button id="battle-next-button" style="display: none;">Next Floor</button>
                <button id="battle-retry-button" style="display: none;">Retry</button>
                <button id="battle-return-button" style="display: none;">Return to Campaign</button>
            </div>
        </div>
    </div>

    <!-- CHAT FEATURE -->
    <div id="chat-container">
        <div id="chat-header">
            <h3>World Chat</h3>
            <button id="chat-toggle-btn">â–¾</button>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input-area">
            <input type="text" id="chat-input" placeholder="Type a message...">
            <button id="chat-send-button">Send</button>
        </div>
    </div>

    <div id="message-box"></div>

    <!-- Link to our JavaScript file -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    <!-- ======================================================= -->
    <!-- ==== NEW PRE-BATTLE MODAL - ADD THIS ENTIRE BLOCK ===== -->
    <!-- ======================================================= -->
    <div id="intel-modal-overlay" class="modal-overlay">
        <div id="intel-modal-content" class="modal-content">
            <h2>Stage Intel</h2>
            <div id="intel-enemy-info">
                <!-- Enemy details will be injected here -->
            </div>
            <div class="modal-buttons">
                <button id="intel-change-team-btn">Change Team</button>
                <button id="intel-start-fight-btn">FIGHT!</button>
                <button id="intel-close-btn">Back</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

<div id="hero-detail-overlay" class="modal-overlay">
    <div id="hero-detail-content" class="modal-content">
        <!-- Content injected by JS -->
    </div>
</div>

<div id="hero-image-overlay" class="modal-overlay">
    <div class="modal-content">
        <img id="hero-image-large" src="" alt="Hero" style="max-width:300px; height:auto;">
        <button id="close-hero-image-btn">Close</button>
    </div>
</div>

<div id="tutorial-modal" class="modal-overlay">
    <div class="modal-content">
        <p id="tutorial-text"></p>
        <button id="tutorial-close-btn">Close</button>
    </div>
</div>

<div id="profile-modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Profile</h3>
        <input type="email" id="profile-email" placeholder="Email">
        <input type="password" id="profile-password" placeholder="New Password">
        <select id="profile-image-select"></select>
        <div class="modal-buttons">
            <button id="profile-save-btn">Save</button>
            <button id="profile-cancel-btn">Cancel</button>
        </div>
    </div>
</div>

<div id="register-modal-overlay" class="modal-overlay">
    <div class="modal-content">
        <h3>Create Account</h3>
        <input type="text" id="reg-username" placeholder="Username">
        <input type="email" id="reg-email" placeholder="Email">
        <input type="password" id="reg-password" placeholder="Password">
        <input type="password" id="reg-confirm-password" placeholder="Confirm Password">
        <div class="modal-buttons">
            <button id="register-submit-btn">Register</button>
            <button id="register-cancel-btn">Cancel</button>
        </div>
    </div>
</div>


</body>
</html>